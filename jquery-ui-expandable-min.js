/*!
* jQuery UI Expandable v1.3
*
* Copyright 2011, Tony Kramer
* Dual licensed under the MIT or GPL Version 2 licenses.
* https://github.com/flamewave/jquery-ui-expandable/raw/master/GPL-LICENSE.txt
* https://github.com/flamewave/jquery-ui-expandable/raw/master/MIT-LICENSE.txt
*/
(function(a){a.widget("ui.expandable",{version:"1.3",options:{disabled:false,defaultState:null,titleSelector:"> h3",icon:{collapsed:"ui-icon-triangle-1-e",collapsedTitle:null,expanded:"ui-icon-triangle-1-s",expandedTitle:null},showFx:{effect:"slide",options:{direction:"up"},duration:"normal",callback:null},hideFx:{effect:"slide",options:{direction:"up"},duration:"normal",callback:null},ajax:{enabled:false,attr:"rel",cache:true,options:null}},_isTable:false,_headers:null,_getContentElement:function(b){return b.next()},_getContentContainer:function(b){return b.next()},_getIconContainer:function(b){return b},_create:function(){this._isTable=this.element.attr("tagName").toLowerCase()==="table";if(this._isTable&&(!this.options.titleSelector||!this.options.titleSelector.length||this.options.titleSelector.toLowerCase()==="> h3")){this.options.titleSelector="> tbody > tr:even"}if(this._isTable){this._getContentElement=function(b){return b.next().children("td,th").first()};this._getIconContainer=function(b){return b.find("th,td").first()}}this.element.addClass("ui-helper-reset ui-widget ui-expandable");this._headers=this.element.find(this.options.titleSelector);this._createExpandos()},destroy:function(){this.element.removeData("expandable.ajaxLoaded").removeClass("ui-helper-reset ui-widget ui-expandable");var b=this,c=this._useIcons();this._headers.each(function(f){var e=a(this),d=b._getContentContainer(e);e.removeClass("ui-widget-header ui-expandable-header ui-corner-top ui-corner-all ui-expandable-table-header").unbind("click.expandable");d.show().removeClass("ui-corner-bottom ui-widget-content ui-expandable-content ui-expandable-table-content");if(!b._isTable){d.next().remove()}if(c){b._removeIcon(e)}});this._headers=null;a.Widget.prototype.destroy.call(this);return this},refresh:function(){this._headers=this.element.find(this.options.titleSelector);this._createExpandos()},count:function(){return this._headers.length},_createExpandos:function(){var b=this,c=this._useIcons();this._headers.each(function(f){var e=a(this);if(e.data("expandable.created")===true){if(e.data("expandable.index")!==f){e.data("expandable.index",f).unbind("click.expandable").bind("click.expandable",function(){b.toggle(f)})}return}var g=b._getItemStateFromObj(f,e,b.options.defaultState,true),d=b._getContentContainer(e);e.data("expandable.created",true).data("expandable.index",f).bind("click.expandable",function(){b.toggle(f)});d[g?"show":"hide"]();if(g){b._loadContent(e)}if(b._isTable){e.addClass("ui-expandable-table-header");d.addClass("ui-expandable-table-content")}else{e.addClass("ui-helper-reset ui-widget-header ui-expandable-header").addClass(g?"ui-corner-top":"ui-corner-all");d.addClass("ui-helper-reset ui-corner-bottom ui-widget-content ui-expandable-content").after(a('<div class="ui-expandable-spacer">&nbsp;</div>'))}if(c){b._addIcon(e,g)}})},_useIcons:function(){return this.options.icon!==undefined&&this.options.icon!==null&&typeof this.options.icon.collapsed==="string"&&this.options.icon.collapsed.length>0&&typeof this.options.icon.expanded==="string"&&this.options.icon.expanded.length>0},_addIcon:function(b,c){this._getIconContainer(b).prepend(a('<span class="ui-icon ui-expandable-icon">&nbsp;</span>').addClass(c?this.options.icon.expanded:this.options.icon.collapsed).attr("title",c?(this.options.icon.expandedTitle||a.ui.expandable.globalization.defaultIconExpandedTitle):(this.options.icon.collapsedTitle||a.ui.expandable.globalization.defaultIconCollapsedTitle)))},_removeIcon:function(b){this._getIconContainer(b).children(".ui-expandable-icon").remove()},_setOption:function(b,d){var c=this;switch(b){case"disabled":if(d){this.disable()}else{this.enable()}break;case"icon":this._headers.each(function(){var e=a(this);c._removeIcon(e);c._addIcon(e,c._isExpanded(e))});case"defaultState":case"titleSelector":throw b+" option can only be set on creation.";default:a.Widget.prototype._setOption.call(this,b,d);break}return this},disable:function(b){this.options.disabled=true;this._parseItems(b,function(c){if(c&&c.length){c.add(this._getContentContainer(c)).addClass("ui-expandable-disabled ui-state-disabled")}},null);return this},enable:function(b){this.options.disabled=false;this._parseItems(b,function(c){if(c&&c.length){c.add(this._getContentContainer(c)).removeClass("ui-expandable-disabled ui-state-disabled")}},null);return this},isExpanded:function(b){var c=true;this._parseItems(b,function(d){if(!this._isExpanded(d)){c=false;return false}},null);return c},setItemStates:function(e,b,c){if(this.options.disabled){return this}if(e===undefined||e===null){this.collapse(null,b)}else{var d=this;this._headers.each(function(g){var f=a(this);if(d._getItemStateFromObj(g,f,e,false)){d._expandItem(f,b,c)}else{d._collapseItem(f,b)}})}return this},toggle:function(b,c,d){if(!this.options.disabled){this._parseItems(b,function(e){this._toggleItem(e,c,d)},"toggleAll")}return this},expand:function(b,c,d){if(!this.options.disabled){this._parseItems(b,function(e){this._expandItem(e,c,d)},"expandAll")}return this},collapse:function(b,c){if(!this.options.disabled){this._parseItems(b,function(d){this._collapseItem(d,c)},"collapseAll")}return this},_isExpanded:function(b){return b&&b.length&&this._getContentContainer(b).is(":visible")},_toggleItem:function(b,c,d){if(!b||!b.length||this.options.disabled){return}if(this._isExpanded(b)){this._collapseItem(b,c)}else{this._expandItem(b,c,d)}},_expandItem:function(f,g,h){if(!f||!f.length||this.options.disabled){return}f.find(".ui-expandable-icon").removeClass(this.options.icon.collapsed).addClass(this.options.icon.expanded).attr("title",this.options.icon.expandedTitle||a.ui.expandable.globalization.defaultIconExpandedTitle);if(!this._isTable){f.removeClass("ui-corner-all").addClass("ui-corner-top")}var e=this._getContentContainer(f);if(this.options.showFx&&g!==true){var d=this,c=typeof this.options.showFx.duration==="string"?this.options.showFx.duration:this.options.showFx.duration||400,b=function(){if(a.isFunction(d.options.showFx.callback)){d.options.showFx.callback()}d._trigger("expanded",null,{head:f[0],content:e[0]});d._loadContent(f,h)};if(a.effects&&a.effects[this.options.showFx.effect]){e.show(this.options.showFx.effect,this.options.showFx.options,c,b)}else{if(this.options.showFx.effect&&e[this.options.showFx.effect]){e[this.options.showFx.effect](c,b)}else{e.show(c,b)}}}else{e.show();this._trigger("expanded",null,{head:f[0],content:e[0]});this._loadContent(f,h)}},_collapseItem:function(f,g){if(!f||!f.length||this.options.disabled){return}f.find(".ui-expandable-icon").removeClass(this.options.icon.expanded).addClass(this.options.icon.collapsed).attr("title",this.options.icon.collapsedTitle||a.ui.expandable.globalization.defaultIconCollapsedTitle);if(!this._isTable){f.removeClass("ui-corner-top").addClass("ui-corner-all")}var e=this._getContentContainer(f);if(this.options.hideFx&&g!==true){var d=this,c=typeof this.options.hideFx.duration==="string"?this.options.hideFx.duration:this.options.hideFx.duration||400,b=function(){if(a.isFunction(d.options.hideFx.callback)){d.options.hideFx.callback()}d._trigger("collapsed",null,{head:f[0],content:e[0]})};if(a.effects&&a.effects[this.options.hideFx.effect]){e.hide(this.options.hideFx.effect,this.options.hideFx.options,c,b)}else{if(e[this.options.hideFx.effect]){e[this.options.hideFx.effect](c,b)}else{e.hide(c,b)}}}else{e.hide();this._trigger("collapsed",null,{head:f[0],content:e[0]})}},loadContent:function(c,b){if(this.options.ajax&&this.options.ajax.enabled===true&&this.options.ajax.attr&&this.options.ajax.attr.length){this._parseItems(c,function(d){this._loadContent(d,b)},null)}return this},setContent:function(d,b){if(d===undefined||d===null){throw"No items specified."}if(a.isFunction(d)){d=d();if(d===undefined||d===null){throw"Function given to items parameter can not return an undefined or null value."}}if(typeof d==="string"){if(d==="first"||d==="last"){this._setItemContent(this._headers[d](),b,false,false)}else{this._setItemContent(this._headers.filter("#"+d),b,false,false)}return this}if(typeof d==="number"&&d>=0){this._setItemContent(this._headers.eq(d),b,false,false);return this}if(d instanceof jQuery){if(d.length===1){this._setItemContent(d,b,false,false)}else{if(d.length>1){var f=this;d.each(function(){f._setItemContent(a(this),b,false,false)})}}return this}for(var e in d){var c=parseInt(e);if(!isNaN(c)&&c>=0){this._setItemContent(this._headers.eq(c),d[e],false,false)}else{this._setItemContent(this._headers.filter("#"+e),d[e],false,false)}}return this},_setItemContent:function(c,b,d,e){if(!c||!c.length){return}if(a.isFunction(b)){b=b(c[0])}var f=this._getContentElement(c).html(b);if(d&&this.options.ajax.cache===true){c.data("expandable.ajaxLoaded",!e)}this._trigger(d&&e?"failedLoad":"contentSet",null,{head:c[0],content:f[0]})},_loadContent:function(d,c){if(!d||!d.length){return}if(this.options.ajax&&this.options.ajax.enabled===true&&this.options.ajax.attr&&this.options.ajax.attr.length&&(c||this.options.ajax.cache!==true||d.data("expandable.ajaxLoaded")!==true)){var h=d.attr(this.options.ajax.attr);if(h&&h.length){var g=this.options.ajax.options&&a.isFunction(this.options.ajax.options.success)?this.options.ajax.options.success:null;var b=this.options.ajax.options&&a.isFunction(this.options.ajax.options.error)?this.options.ajax.options.error:null;var e=a.extend(true,{url:h,dataType:"html"},this.options.ajax.options);var f=this;e.success=function(i,k,j){if(g!==null){i=g(i,k,j,d[0])}f._setItemContent(d,i,true,false)};e.error=function(j,k,i){if(b!==null){k=b(j,k,i,d[0])}f._setItemContent(d,k,true,true)};a.ajax(e)}}},_getItemStateFromObj:function(c,b,e,d){if(e===undefined||e===null){return d}if(typeof e==="boolean"){return e}if(a.isFunction(e)){return e(c,b[0])}if(a.isArray(e)){return e.length>=c?e[c]===true:d}if(e[c]!==undefined){return e[c]===true}if(e[c.toString()]!==undefined){return e[c.toString()]===true}var f=b.attr("id");if(f.length&&e[f]!==undefined){return e[f]===true}return d},_parseItems:function(e,c,b){var f=this;if(e===undefined||e===null){this._headers.each(function(){return c.call(f,a(this))});if(typeof b==="string"&&b.length){this._trigger(b,null,null)}return}if(a.isFunction(e)){e=e();if(e===undefined||e===null){throw"Function given to items parameter can not return an undefined or null value."}}if(typeof e==="string"){if(!e.length){throw"items can not be an empty string."}else{if(e==="first"||e==="last"){c.call(this,this._headers[e]())}else{c.call(this,this._headers.filter("#"+e))}}return}if(typeof e==="number"&&e>=0){c.call(this,this._headers.eq(e));return}if(e instanceof jQuery){if(e.length===1){c.call(this,e)}else{if(e.length>1){e.each(function(){return c.call(f,a(this))})}}return}if(a.isArray(e)&&e.length>0){for(var d=0;d<e.length;d++){if(typeof e[d]==="number"&&e[d]>=0){if(c.call(this,this._headers.eq(e[d]))===false){break}}else{if(typeof e[d]==="string"&&e[d].length){if(c.call(this,this._headers.filter("#"+e[d]))===false){break}}else{throw"Array items must be either a non-negative number or a non-empty string."}}}return}throw"items parameter must be either a function, non-empty string, non-negative number, jQuery object instance, or an array of (non-negative) numbers and/or HTML ID attribute string values."}});a.ui.expandable.globalization={defaultIconCollapsedTitle:"Click to expand",defaultIconExpandedTitle:"Click to collapse"}})(jQuery);