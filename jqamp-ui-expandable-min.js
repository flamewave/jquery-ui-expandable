/*!
* jQuery UI Expandable v1.4
*
* Copyright 2012, Tony Kramer
* Dual licensed under the MIT or GPL Version 2 licenses.
* https://github.com/flamewave/jquery-ui-expandable/raw/master/GPL-LICENSE.txt
* https://github.com/flamewave/jquery-ui-expandable/raw/master/MIT-LICENSE.txt
*/
(function(f){f.widget("jqAmpUI.expandable",{version:"1.4",options:{disabled:!1,defaultState:null,titleSelector:"> h3",icon:{collapsed:"ui-icon-triangle-1-e",collapsedTitle:null,expanded:"ui-icon-triangle-1-s",expandedTitle:null},showFx:{effect:"slide",options:{direction:"up"},duration:"normal",callback:null},hideFx:{effect:"slide",options:{direction:"up"},duration:"normal",callback:null},ajax:{enabled:!1,attr:"rel",cache:!0,options:null},noWidgetClasses:!1,contentElement:null,contentContainer:null,iconContainer:null},_isTable:!1,_headers:null,_create:function(){var a=this.options;if("table"===this.element.attr("tagName").toLowerCase()){this._isTable=!0;if(!a.titleSelector||"> h3"===a.titleSelector.toLowerCase())a.titleSelector="> tbody > tr:even";a.contentElement||(a.contentElement=function(a){return a.next().children("td,th").first()});a.iconContainer||(a.iconContainer=function(a){return a.find("th,td").first()})}else if(a.contentElement||(a.contentElement=function(a){return a.next()}),!a.iconContainer)a.iconContainer=function(a){return a};a.contentContainer||(a.contentContainer=function(a){return a.next()});this.element.addClass("ui-helper-reset ui-widget ui-expandable");this._headers=this.element.find(this.options.titleSelector);this._createExpandos()},destroy:function(){this.element.removeData("expandable.ajaxLoaded").removeClass("ui-helper-reset ui-widget ui-expandable");var a=this,c=this._useIcons();this._headers.each(function(){var b=f(this),d=a.options.contentContainer(b);b.removeClass("ui-helper-reset ui-widget-header ui-expandable-header ui-corner-top ui-corner-all ui-expandable-table-header").unbind("click.expandable").removeData("expandable.created").removeData("expandable.index");d.show().removeClass("ui-helper-reset ui-corner-bottom ui-widget-content ui-expandable-content ui-expandable-table-content");a._isTable||d.next().remove();c&&a._removeIcon(b)});this._headers=null;f.Widget.prototype.destroy.call(this);return this},refresh:function(){this._headers=this.element.find(this.options.titleSelector);this._createExpandos()},count:function(){return this._headers.length},_createExpandos:function(){var a=this,c=this.options,b=this._useIcons();this._headers.each(function(d){var e=f(this);if(!0===e.data("expandable.created"))e.data("expandable.index")!==d&&e.data("expandable.index",d).unbind("click.expandable").bind("click.expandable",function(){a.toggle(d)});else{var g=e.data("expanded")?!0:a._getItemStateFromObj(d,e,c.defaultState,!0),h=c.contentContainer(e);e.data("expandable.created",!0).data("expandable.index",d).bind("click.expandable",function(){a.toggle(d)});h[g?"show":"hide"]();g&&a._loadContent(e);a._isTable?(e.addClass("ui-expandable-table-header"),h.addClass("ui-expandable-table-content")):(c.noWidgetClasses?(e.addClass("ui-expandable-header"),h.addClass("ui-expandable-content")):(e.addClass("ui-helper-reset ui-widget-header ui-expandable-header").addClass(g?"ui-corner-top":"ui-corner-all"),h.addClass("ui-helper-reset ui-corner-bottom ui-widget-content ui-expandable-content")),h.after(f('<div class="ui-expandable-spacer"></div>')));b&&a._addIcon(e,g)}})},_useIcons:function(){var a=this.options.icon;return void 0!==a&&null!==a&&"string"===typeof a.collapsed&&0<a.collapsed.length&&"string"===typeof a.expanded&&0<a.expanded.length},_addIcon:function(a,c){var b=this.options;b.iconContainer(a).prepend(f('<span class="ui-icon ui-expandable-icon"></span>').addClass(c?b.icon.expanded:b.icon.collapsed).attr("title",c?b.icon.expandedTitle||f.jqAmpUI.expandable.globalization.defaultIconExpandedTitle:b.icon.collapsedTitle||f.jqAmpUI.expandable.globalization.defaultIconCollapsedTitle))},_removeIcon:function(a){this.options.iconContainer(a).children(".ui-expandable-icon").remove()},_setOption:function(a,c){var b=this;switch(a){case "disabled":c?this.disable():this.enable();break;case "icon":this._headers.each(function(){var a=f(this);b._removeIcon(a);b._addIcon(a,b._isExpanded(a))});case "defaultState":case "titleSelector":case "noWidgetClasses":case "contentElement":case "contentContainer":case "iconContainer":if(window.console){var d="Expandable: "+a+" option can only be set on creation.";console.warn?console.warn(d):console.log&&console.log(d)}break;default:f.Widget.prototype._setOption.call(this,a,c)}return this},disable:function(a){this.options.disabled=!a;this._parseItems(a,function(a){a&&a.length&&a.add(this.options.contentContainer(a)).addClass("ui-expandable-disabled ui-state-disabled")},null);return this},enable:function(a){this.options.disabled=!!a;this._parseItems(a,function(a){a&&a.length&&a.add(this.options.contentContainer(a)).removeClass("ui-expandable-disabled ui-state-disabled")},null);return this},isExpanded:function(a){var c=!0;this._parseItems(a,function(a){if(!this._isExpanded(a))return c=!1},null);return c},setItemStates:function(a,c,b){if(this.options.disabled)return this;if(void 0===a||null===a)this.collapse(null,c);else{var d=this;this._headers.each(function(e){var g=f(this);d._getItemStateFromObj(e,g,a,!1)?d._expandItem(g,c,b):d._collapseItem(g,c)})}return this},toggle:function(a,c,b){this.options.disabled||this._parseItems(a,function(a){this._toggleItem(a,c,b)},"toggleAll");return this},expand:function(a,c,b){this.options.disabled||this._parseItems(a,function(a){this._expandItem(a,c,b)},"expandAll");return this},collapse:function(a,c){this.options.disabled||this._parseItems(a,function(a){this._collapseItem(a,c)},"collapseAll");return this},_isExpanded:function(a){return a&&a.length&&this.options.contentContainer(a).is(":visible")},_toggleItem:function(a,c,b){a&&a.length&&!a.hasClass("ui-state-disabled")&&(this._isExpanded(a)?this._collapseItem(a,c):this._expandItem(a,c,b))},_expandItem:function(a,c,b){if(a&&a.length&&!a.hasClass("ui-state-disabled")&&!this._isExpanded(a)){var d=this.options,e=d.showFx,g=d.contentContainer(a);if(!1!==this._trigger("beforeExpand",null,{head:a[0],content:g[0]}))if(a.find(".ui-expandable-icon").removeClass(d.icon.collapsed).addClass(d.icon.expanded).attr("title",d.icon.expandedTitle||f.jqAmpUI.expandable.globalization.defaultIconExpandedTitle),!this._isTable&&!d.noWidgetClasses&&a.removeClass("ui-corner-all").addClass("ui-corner-top"),e&&!0!==c){var h=this,c="string"===typeof e.duration?e.duration:e.duration||400,i=function(){f.isFunction(e.callback)&&e.callback();h._trigger("expanded",null,{head:a[0],content:g[0]});h._loadContent(a,b)};if(f.effects&&f.effects[e.effect])g.show(e.effect,e.options,c,i);else if(e.effect&&g[e.effect])g[d.showFx.effect](c,i);else g.show(c,i)}else g.show(),this._trigger("expanded",null,{head:a[0],content:g[0]}),this._loadContent(a,b)}},_collapseItem:function(a,c){if(a&&a.length&&!a.hasClass("ui-state-disabled")&&this._isExpanded(a)){var b=this.options,d=b.hideFx,e=b.contentContainer(a);if(!1!==this._trigger("beforeCollapse",null,{head:a[0],content:e[0]}))if(a.find(".ui-expandable-icon").removeClass(b.icon.expanded).addClass(b.icon.collapsed).attr("title",b.icon.collapsedTitle||f.jqAmpUI.expandable.globalization.defaultIconCollapsedTitle),!this._isTable&&!b.noWidgetClasses&&a.removeClass("ui-corner-top").addClass("ui-corner-all"),d&&!0!==c){var g=this,b="string"===typeof d.duration?d.duration:d.duration||400,h=function(){f.isFunction(d.callback)&&d.callback();g._trigger("collapsed",null,{head:a[0],content:e[0]})};if(f.effects&&f.effects[d.effect])e.hide(d.effect,d.options,b,h);else if(e[d.effect])e[d.effect](b,h);else e.hide(b,h)}else e.hide(),this._trigger("collapsed",null,{head:a[0],content:e[0]})}},loadContent:function(a,c){this.options.ajax&&!0===this.options.ajax.enabled&&this.options.ajax.attr&&this._parseItems(a,function(a){this._loadContent(a,c)},null);return this},setContent:function(a,c){if(void 0===a||null===a)throw"No items specified.";if(f.isFunction(a)&&(a=a(),void 0===a||null===a))throw"ExpandableException: Function given to items parameter can not return an undefined or null value.";if("string"===typeof a)return"first"===a||"last"===a?this._setItemContent(this._headers[a](),c,!1,!1):this._setItemContent(this._headers.filter("#"+a),c,!1,!1),this;if("number"===typeof a&&0<=a)return this._setItemContent(this._headers.eq(a),c,!1,!1),this;if(a instanceof jQuery){if(1===a.length)this._setItemContent(a,c,!1,!1);else if(1<a.length){var b=this;a.each(function(){b._setItemContent(f(this),c,!1,!1)})}return this}for(var d in a){var e=parseInt(d);!isNaN(e)&&0<=e?this._setItemContent(this._headers.eq(e),a[d],!1,!1):this._setItemContent(this._headers.filter("#"+d),a[d],!1,!1)}return this},_setItemContent:function(a,c,b,d){a&&a.length&&(f.isFunction(c)&&(c=c(a[0])),c=this.options.contentElement(a).html(c),b&&!0===this.options.ajax.cache&&a.data("expandable.ajaxLoaded",!d),this._trigger(b&&d?"failedLoad":"contentSet",null,{head:a[0],content:c[0]}))},_loadContent:function(a,c){if(a&&a.length){var b=this.options.ajax;if(b&&!0===b.enabled&&b.attr&&(c||!0!==b.cache||!0!==a.data("expandable.ajaxLoaded"))){var d=a.attr(b.attr);if(d&&d.length){var e=b.options&&f.isFunction(b.options.success)?b.options.success:null,g=b.options&&f.isFunction(b.options.error)?b.options.error:null,b=f.extend(!0,{url:d,dataType:"html"},b.options),h=this;b.success=function(b,c,d){null!==e&&(b=e(b,c,d,a[0]));h._setItemContent(a,b,!0,!1)};b.error=function(b,c,d){null!==g&&(c=g(b,c,d,a[0]));h._setItemContent(a,c,!0,!0)};f.ajax(b)}}}},_getItemStateFromObj:function(a,c,b,d){if(void 0===b||null===b)return d;if("boolean"===typeof b)return b;if(f.isFunction(b))return b(a,c[0]);if(f.isArray(b))return b.length>=a?!0===b[a]:d;if(void 0!==b[a])return!0===b[a];if(void 0!==b[a.toString()])return!0===b[a.toString()];a=c.attr("id");return a.length&&void 0!==b[a]?!0===b[a]:d},_parseItems:function(a,c,b){var d=this;if(void 0===a||null===a)this._headers.each(function(){return c.call(d,f(this))}),"string"===typeof b&&b.length&&this._trigger(b,null,null);else{if(f.isFunction(a)&&(a=a(),void 0===a||null===a))throw"ExpandableException: Function given to items parameter can not return an undefined or null value.";if("string"===typeof a)if(a.length)"first"===a||"last"===a?c.call(this,this._headers[a]()):c.call(this,this._headers.filter("#"+a));else throw"items can not be an empty string.";else if("number"===typeof a&&0<=a)c.call(this,this._headers.eq(a));else if(a instanceof jQuery)1===a.length?c.call(this,a):1<a.length&&a.each(function(){return c.call(d,f(this))});else if(f.isArray(a)&&0<a.length)for(b=0;b<a.length;b++)if("number"===typeof a[b]&&0<=a[b]){if(!1===c.call(this,this._headers.eq(a[b])))break}else if("string"===typeof a[b]&&a[b].length){if(!1===c.call(this,this._headers.filter("#"+a[b])))break}else throw"ExpandableException: Array items must be either a non-negative number or a non-empty string.";else throw"ExpandableException: items parameter must be either a function, non-empty string, non-negative number, jQuery object instance, or an array of (non-negative) numbers and/or HTML ID attribute string values.";}}});f.jqAmpUI.expandable.globalization={defaultIconCollapsedTitle:"Click to expand",defaultIconExpandedTitle:"Click to collapse"}})(jQuery);